@model IEnumerable<TicketsAndretich.Web.Models.ApplicationUser>
@{
    ViewData["Title"] = "Administraci√≥n de Usuarios";
    var departments = (Microsoft.AspNetCore.Mvc.Rendering.SelectList)ViewBag.Departments;
    var roles = (IEnumerable<string>)ViewBag.Roles;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Usuarios</h2>
    <a asp-action="CrearUsuario" class="btn btn-primary">
        ‚ûï Nuevo Usuario
    </a>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="card">
    <div class="card-body p-0">
        <table class="table table-striped table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Email</th>
                    <th>Nombre</th>
                    <th>Departamento</th>
                    <th>Estado</th>
                    <th style="width: 180px;">Acciones</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var u in Model)
            {
                <tr>
                    <td>
                        <strong>@u.Email</strong>
                    </td>
                    <td>@u.FirstName @u.LastName</td>
                    <td>
                        @if (u.Department != null)
                        {
                            <span class="badge bg-secondary">@u.Department.Name</span>
                        }
                        else
                        {
                            <span class="text-muted">Sin asignar</span>
                        }
                    </td>
                    <td>
                        @if (u.IsActive)
                        {
                            <span class="badge bg-success">Activo</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">Inactivo</span>
                        }
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a asp-action="EditarUsuario" asp-route-id="@u.Id" class="btn btn-outline-primary" title="Editar">
                                ‚úèÔ∏è Editar
                            </a>
                            @if (u.Email != User.Identity?.Name)
                            {
                                <form asp-action="EliminarUsuario" method="post" class="d-inline" 
                                      onsubmit="return confirm('¬øEst√°s seguro de eliminar este usuario?');">
                                    <input type="hidden" name="id" value="@u.Id" />
                                    <button type="submit" class="btn btn-outline-danger" title="Eliminar">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            }
                        </div>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<div class="mt-3">
    <a class="btn btn-outline-secondary" asp-action="Departamentos">‚Üê Volver a Departamentos</a>
</div>
